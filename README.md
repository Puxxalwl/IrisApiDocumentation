# IrisApiDocumentation
Неофициальная документация по **Iris API** основана на известной мне структуре.

# Оглавление Iris API

---

## Введение для разработчиков
- [Что такое Iris API](#введение-для-разработчиков)

## Подключение
- [Получение Iris-Token](#подключение)
- [Формат HTTP запросов](#подключение)

## Проверка
- [Проверка работы API](#проверка)

## Методы

### Баланс
- [pocket/balance](#pocketbalance)

### Передача ирисок и голда
- [pocket/sweets/give](#pocketsweetsgive)
- [pocket/gold/give](#pocketgoldgive)

### История операций
- [pocket/sweets/history](#pocketsweetshistory)
- [pocket/gold/history](#pocketgoldhistory)

### Управление мешком
- [pocket/enable](#pocketenable)
- [pocket/disable](#pocketdisable)

### Управление передачей валюты
- [pocket/allow_all](#pocketallow_all)
- [pocket/deny_all](#pocketdeny_all)
- [pocket/deny_user](#pocketdeny_user)
- [pocket/allow_user](#pocketallow_user)

## Обработка ошибок
- [Формат ошибок](#обработка-ошибок)
- [Возможные ошибки](#возможные-ошибки)
---

### Введение для разработчиков
**Iris API** — это HTTP-интерфейс, для управление и взаимодействия с Ирисками и Ирис-голд Iris | Чат-Менеджера в Telegram

Перед началом вам стоит определиться на каком языке програмированния вы будете писать (Мой личный совет: C# или Python) и будете ли вы использовать готовые библиотеки, их можно найти [здесь](https://github.com/C0dwiz/IrisAPI-list) и следовать документации которую предлагают клиентские библиотеки, но если же вы хотите с полного нуля начать и понять что да как, оставайтесь здесь

---

# Подключение
Для начала нужно получить Iris-Token, его можно получить у [@iris_cm](t.me/iris_cm) командой "`+ирис коннект`" и следуя инструкциям, или же у: [@irisism](t.me/irisism)
И теперь можно приступать к работе
**Iris API использует HTTP запросы в формате: https://iris-tg.ru/api/{bot_id}_{Iris-Token}/v{version}/{method}?{params}** возвращающий JSON. Далее нам предстоит работать с этим
version — версия API, на данный момент 0.1 но советуется ставить 100 для получения самых последних версий
---


## Проверка
Изначально проверьте работает ли у вас Api простым запросом (можно даже в браузере) `https://iris-tg.ru/api/{bot_id}_{Iris-Token}/v100/pocket/balance` если ответ будет наподобии:
```JSON
{"gold":0,"sweets":0.0,"donate_score":0}
```
Отлично! вы можете приступать, если нет — сообщите в чат Iris | Connect API

---

## Методы

### pocket/balance
Возвращает текущий баланс пользователя в ирисках/ирис-голд и од

| Аргументы |
|:-----|
| null |

Возвращает:
`int gold` — ирис-голд
`float sweets` — ириски
`int donate_score` — очки доната

---

### pocket/sweets/give
Передает ириски пользователю

| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| user_id | int | ID получателя |
| sweets | int | кол-во ирисок для перевода | 
| comment | string? | Коментарий к переводу |
| without_donate_score | bool? | Использовать ли очки доната |

возвращает:
`bool result` — успешность передачи

---

### pocket/gold/give
Передает ирис-голд пользователю

| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| user_id | int | ID получателя |
| sweets | int | кол-во ирисок для перевода | 
| comment | string? | Коментарий к переводу |
| without_donate_score | bool? | Использовать ли очки доната |

возвращает:
`bool result` — успешность передачи

---

### pocket/sweets/history
Показывает историю путишествий ирисок

| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| offset | int? | Сам не понимаю |

> offset+1 будет почти аналог long-polling для получения уведомлений

возвращает:
`int date` — Unix время в миллисекундах
`float amount` — количество ирисок
`float balance` — баланс после операции
`int to_user_id` — получатель/отправитель
`int id` — айди операции
`string type` — тип перевода take/give (Получение/передача)
`List info` — donateScore сколько сьело од, sweets количество, commision коммисия. **Для типа take отсутствуют donateScore && commision**

---

### pocket/gold/history
Показывает историю путишествий ирис-голд

| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| offset | int? | Сам не понимаю |

> offset+1 будет почти аналог long-polling для получения уведомлений


возвращает:
`int date` — Unix время в миллисекундах
`float amount` — количество голд
`float balance` — баланс после операции
`int to_user_id` — получатель/отправитель
`int id` — айди операции
`string type` — тип перевода take/give (Получение/передача)
`List info` — donateScore сколько сьело од, gold количество, commision коммисия. **Для типа take отсутствуют donateScore && commision**

---

### pocket/enable
Включает возможность просмотра мешка


| Аргументы |
|:-----|
| null |

возвращает:
`bool result`

---

### pocket/disable
Отключает возможность просмотра мешка


| Аргументы |
|:-----|
| null |

возвращает:
`bool result`

---

### pocket/allow_all
Включает возможность передачи валюты всем


| Аргументы |
|:-----|
| null |

возвращает:
`bool result`

---

### pocket/deny_all
Отключает возможность передачи валюты всем


| Аргументы |
|:-----|
| null |

возвращает:
`bool result`

---

### pocket/deny_user
Отключает возможность передачи валюты отдельному пользователю


| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| user_id | int | Пользователь которому запрещается перевод |

возвращает:
`bool result`

---

### pocket/allow_user
Включает возможность передачи валюты отдельному пользователю


| Аргументы | Тип | описание |
|:-----| :-----| :-----|
| user_id | int | Пользователь которому разрешается перевод |

возвращает:
`bool result`

## Обработка ошибок

В API есть формат ответов ошибок, если запрос не выполнен успешно, API возвращает:
```JSON
{"error":{"code":1,"description":"Описание ошибки"}}
```

API дублирует ошибки кода в HTTP response status code поэтому библиотеки должны уметь обрабатывать коды отличные от 200 OK.

## Возможные ошибки

| Code | Description |
|------|-------------|
| 400  | Sweets/Gold is 0 |
| 400  | User is not set |
| 404  | User not found |
| 403  | Account is not user |
| 500  | Ошибка в расчёте сжигании ирисок. Обратитесь к агентам |
| 409  | Not enough sweets/gold. Need $value |
| 409  | Unsuccessful donate score decrease |
| 409  | Unsuccessful sweets/gold decrease |
